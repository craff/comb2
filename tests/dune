(test
  (name test)
  (modules test)
  (libraries unix pacomb)
  (action (run ./test.exe)))

(test
  (name hard)
  (modules hard)
  (flags -ppx "./ppx/ppx_pacomb.exe")
  (libraries unix pacomb)
  (deps ../ppx/ppx_pacomb.exe hard.exe)
  (action (run ./hard.exe 1000)))

(test
  (name ppx_test)
  (modules ppx_test)
  (flags -ppx "./ppx/ppx_pacomb.exe")
  (libraries unix pacomb)
  (deps ../ppx/ppx_pacomb.exe hard.exe)
  (action (run ./ppx_test.exe)))

(executable
  (name big_expr)
  (modules big_expr)
  (libraries))

(test
  (name calc)
  (modules calc)
  (flags -ppx "./ppx/ppx_pacomb.exe")
  (libraries unix pacomb)
  (deps ../ppx/ppx_pacomb.exe big_expr.exe calc.exe)
  (action
    (system "./big_expr.exe 4 4 4 | ./calc.exe")))

(test
  (name calc_prio)
  (modules calc_prio)
  (flags -ppx "./ppx/ppx_pacomb.exe")
  (libraries unix pacomb)
  (deps ../ppx/ppx_pacomb.exe big_expr.exe calc_prio.exe)
  (action
    (system "./big_expr.exe 4 4 4 | ./calc_prio.exe")))

(test
  (name calc_factor)
  (modules calc_factor)
  (flags -ppx "./ppx/ppx_pacomb.exe")
  (libraries unix pacomb)
  (deps ../ppx/ppx_pacomb.exe big_expr.exe calc_factor.exe)
  (action
    (system "./big_expr.exe 4 4 4 | ./calc_factor.exe")))
