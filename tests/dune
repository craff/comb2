(test
  (name test)
  (modules test)
  (modes byte)
  (link_flags compiler-libs/ocamlcommon.cma compiler-libs/ocamlbytecomp.cma compiler-libs/ocamltoplevel.cma metalib.cma)
  (libraries unix pacomb)
  (action (run ./test.exe)))

(test
  (name hard)
  (modules hard)
  (modes byte)
  (flags -ppx "./ppx/ppx_pacomb.exe")
  (libraries unix pacomb)
  (deps ../ppx/ppx_pacomb.exe hard.exe)
  (action (run ./hard.exe 1000)))

(test
  (name ppx_test)
  (modules ppx_test)
  (modes byte)
  (flags -ppx "./ppx/ppx_pacomb.exe")
  (libraries unix pacomb)
  (deps ../ppx/ppx_pacomb.exe hard.exe)
  (action (run ./ppx_test.exe)))

(executable
  (name big_expr)
  (modules big_expr)
  (libraries))

(executable
  (name big_sexp)
  (modules big_sexp)
  (libraries))

(test
  (name calc)
  (modules calc)
  (modes byte)
  (flags -ppx "./ppx/ppx_pacomb.exe")
  (libraries unix pacomb)
  (deps ../ppx/ppx_pacomb.exe big_expr.exe calc.exe)
  (action
    (system "./big_expr.exe 4 4 4 | ./calc.exe")))

(test
  (name calc_prio)
  (modules calc_prio)
  (modes byte)
  (flags -ppx "./ppx/ppx_pacomb.exe")
  (libraries unix pacomb)
  (deps ../ppx/ppx_pacomb.exe big_expr.exe calc_prio.exe)
  (action
    (system "./big_expr.exe 4 4 4 | ./calc_prio.exe")))

(test
  (name calc_factor)
  (modules calc_factor)
  (modes byte)
  (flags -ppx "./ppx/ppx_pacomb.exe")
  (libraries unix pacomb)
  (deps ../ppx/ppx_pacomb.exe big_expr.exe calc_factor.exe)
  (action
    (system "./big_expr.exe 4 4 4 | ./calc_factor.exe")))

(test
  (name sexp)
  (modules sexp)
  (modes byte)
  (flags -ppx "./ppx/ppx_pacomb.exe")
  (libraries unix pacomb)
  (deps ../ppx/ppx_pacomb.exe big_sexp.exe sexp.exe)
  (action
    (system "./big_sexp.exe 1000 | ./sexp.exe")))

(test
  (name sexp_rr)
  (modules sexp_rr)
  (modes byte)
  (flags -ppx "./ppx/ppx_pacomb.exe")
  (libraries unix pacomb)
  (deps ../ppx/ppx_pacomb.exe big_sexp.exe sexp_rr.exe)
  (action
    (system "./big_sexp.exe 1000 | ./sexp_rr.exe")))
